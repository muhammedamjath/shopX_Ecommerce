<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Quicksand:wght@300..700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
      }
      .container {
        padding-bottom: 20px;
      }
      .image {
        position: absolute;
        height: 600px;
        width: 50%;
        top: 130px;
        left: 5%;
        /* background-color: yellow; */
        border-radius: 10px;
        box-shadow: 0px 0px 20px 0px gray;
      }
      .image img {
        height: 70%;
        width: 60%;
        position: relative;
        left: 15%;
        top: 10%;
      }
      .image .sub img {
        height: 70px;
        width: 70px;
        border-radius: 5px;
        border: 1px solid blue;
      }
      .image .sub img:hover {
        transform: scale(1.1);
        transition: 0.4s ease;
      }
      .image .sub {
        display: flex;
        position: relative;
        top: 13%;
        gap: 20px;
        margin-left: 10%;
      }
      .body {
        position: absolute;
        left: 65%;
        top: 20%;
        height: 600px;
        /* background-color: yellow; */
      }
      .body h1 {
        font-family: "Poppins", sans-serif;
        font-weight: 600;
        font-style: normal;
        /* color: white; */
      }
      .body .prize {
        font-family: "Gill Sans", "Gill Sans MT", Calibri, "Trebuchet MS",
          sans-serif;
        font-size: 35px;
        font-weight: bolder;
        margin-top: 10%;
        /* color: white; */
      }
      .body .prize del {
        color: gray;
        font-size: 20px;
      }
      .body .prize span {
        font-size: 20px;
        color: green;
      }
      .body .discription {
        margin-top: 10%;
        max-width: 400px;
        /* color: white; */
      }
      .body .detailes {
        margin-top: 10%;
      }
      .body .detailes .text {
        display: flex;
        gap: 50px;
        line-height: 40px;
        font-family: "Roboto", sans-serif;
        font-weight: 100;
        font-style: normal;
        margin-top: 3%;
        /* color: white; */
      }
      .body .detailes .text .field {
        display: flex;
        flex-direction: column;
        font-weight: 600;
      }
      .body .detailes .text .value {
        display: flex;
        flex-direction: column;
        color: gray;
        font-weight: 600;
      }
      .body .detailes h2 {
        font-family: "Roboto", sans-serif;
        font-weight: 600;
        font-style: normal;
        color: #fb8500;
      }
      .btn {
        position: absolute;
        top: 88%;
      }
      .btn #buy {
        height: 40px;
        width: 150px;
        background-color: blue;
        border: 1px solid gray;
        border-radius: 5px;
        font-size: larger;
        color: white;
        cursor: pointer;
      }
      .btn #cart {
        height: 40px;
        width: 150px;
        background-color: #ffb703;
        border: 1px solid gray;
        border-radius: 5px;
        font-size: larger;
        cursor: pointer;
        /* margin-left: 1%; */
      }
      .btn #cart:hover {
        background-color: #fb8500;
      }
      .image .wishlist {
        height: 50px;
        width: 50px;
        background: none;
        border-radius: 5px;
        border: none;
        font-size: 30px;
        cursor: pointer;
        position: absolute;
        top: 20px;
        left: 90%;
      }

      del {
        text-decoration: line-through;
      }

      /* review */
      .review {
        width: 90%;
        min-height: 300px;
        /* background-color: red; */
        position: relative;
        top: 700px;
        left: 5%;
        padding-bottom: 30px;
      }
      .review p{
        text-align: center;
        font-size: 30px;
      }
      .cardhead{
        height: auto;
        width: 90%;
        /* background-color: #fb8500; */
        margin-left: 5%;
        display: flex;
        gap: 10px;
        flex-direction: column;
      }
      .cardhead .card{
        height: 120px;
        width: 100%;
        border: 1px solid #dde7c7;
      }
      .cardhead .card .stars{
        height: 40px;
        width: 100%;
        background-color: #fbfbf2;
      }
      .cardhead .card .stars span{
        position: relative;
        top: 2px;
        left: 3%;
        font-size: 20px;
      }
      /* .cardhead .card .star span:first-child{
        margin-left: 30px;
      } */
      .cardhead .card .review-text{
        height: 60px;
        width: 97%;
        background-color: #fff;
        display: flex;
        align-items: center;
        padding-left: 3%;
      }
      .cardhead .card .person{
        font-size: 13px;
        display: flex;
        align-items: center;
        height: 20px;
        width: 97%;
        background-color: #eaf4f4;
        padding-left: 3%;
        font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
      }

      .main{
            height: 200px;
            width: 50%;
            background-color: #a4c3b2;
            border-radius: 5px;
            position: relative;
            left: 25%;
            margin-top: 4%;
        }
        .review-this {
        max-width: 70%;
        border-radius: 0.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        top: 10px;
        left: 15%;
      }

      .star {
        font-size: 30px;
        cursor: pointer;
        color: white;
      }

      .one ,.two ,.three ,.four ,.five  {
        color: green;
      }

      .main textarea{
        position: relative;
        top: 20px;
        left: 30%;
      }
      .main p{
        text-align: center;
        margin-top: 1px;
        font-size: 20px;
      }
      .main button{
        height: 30px;
        width: 20%;
        background-color: #fb8500;
        position: relative;
        top: 30px;
        left: 40%;
        border-radius: 5px;
        border: none;
      }
      @media (max-width: 860px) {
        .image {
          position: absolute;
          height: 400px;
          width: 95%;
          top: 100px;
          left: 2.5%;
        }
        .image .sub {
          display: flex;
          position: relative;
          top: 8%;
          gap: 13px;
          margin-left: 0%;
        }
        .image img {
          height: 65%;
          width: 80%;
          position: relative;
          left: 10%;
          top: 10%;
        }
        .image .sub img {
          height: 58px;
          width: 58px;
          border-radius: 5px;
          border: 1px solid blue;
          margin-top: 6%;
        }
        /* body */
        .body {
          position: relative;
          left: 0%;
          top: 75%;
        }
        .body h1 {
          text-align: center;
          font-family: "Poppins", sans-serif;
          font-weight: 500;
          font-style: normal;
        }
        .body .prize {
          font-size: 30px;
          font-weight: bolder;
          margin-top: 5%;
          margin-left: 5%;
        }
        .body .prize del {
          color: gray;
          font-size: 15px;
        }
        .body .prize span {
          font-size: 20px;
          color: green;
        }
        .body .discription {
          margin-top: 10%;
          margin-left: 5%;
          max-width: 340px;
        }
        .body .detailes {
          margin-top: 10%;
          margin-left: 5%;
        }
        .body .detailes .text {
          margin-top: 3%;
        }
        .body .detailes .text .field {
          display: flex;
          flex-direction: column;
          font-weight: 500;
        }
        .body .detailes .text .value {
          display: flex;
          flex-direction: column;
          color: gray;
          font-weight: 400;
        }
        .body .detailes h2 {
          font-family: "Roboto", sans-serif;
          font-weight: 600;
        }
        .btn {
          position: absolute;
          width: 100%;
          top: 88%;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .btn #cart {
          height: 40px;
          width: 230px;
          border-radius: 5px;
          font-size: large;
        }

        .image .wishlist {
          height: 40px;
          width: 40px;
          font-size: 20px;
          top: 0px;
          left: 88%;
        }
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <%- include('layout/header') -%>
  </head>
  <body>
    <%- include('layout/navbar') -%>
    <div class="container">
      <div class="image">
        <img src="/<%= item.image[0] %>" alt="ðŸ˜" class="img" />
        <div class="sub">
          <% item.image.forEach((data)=>{ %>
          <img src="/<%=data %>" alt="ðŸ˜" class="subimg" />
          <% }) %>
        </div>
        <% if(wishdataId == null|| undefined){ %>
        <button
          style="color: white"
          class="wishlist"
          onclick="passIdtoAxios('<%= item._id %>')"
        >
          <i class="fa-solid fa-heart"></i>
        </button>
        <% }else{ %>
        <button
          style="color: red"
          class="wishlist"
          onclick="passIdtoAxios('<%= item._id %>')"
        >
          <i class="fa-solid fa-heart"></i>
        </button>
        <% } %>
      </div>
      <div class="body">
        <h1><%= item.name %></h1>
        <p class="prize">
          â‚¹<%= item.offerprize %> <del>(<%= item.prize %>)</del>
          <span><%= item.prizePercenttage %>% off</span>
        </p>
        <p class="discription"><%= item.discription %></p>
        <div class="detailes">
          <h2>Product detailes</h2>
          <div class="text">
            <div class="field">
              <span>category</span>
              <span>brand</span>
            </div>
            <input id="hidden" type="hidden" value="<%= item._id %>">
            <div class="value">
              <span><%= item.category %></span>
              <span><%= item.brand %></span>
            </div>
          </div>
        </div>
        <div class="btn">
          <button id="cart" onclick="addToCart('<%= item._id %>')">
            Add to cart
          </button>
        </div>
      </div>
      <div class="review">
          <p>reviews</p>
        <div class="cardhead">
          <% reviews.forEach((data)=>{ %>
          <div class="card">
            <div class="stars">
              <span>â˜…</span>
              <span>â˜…</span>
              <span>â˜…</span>
              <span>â˜…</span>
              <span>â˜…</span>
            </div>
            <div class="review-text"> <%= data.content %> </div>
            <div class="person"><%= data.username %></div>
          </div> 
        <%})%>
        </div>
        <div class="main">
          <p>write a review</p>
          <div class="review-this">
            <br />
            <span onclick="gfg(1)" class="star">â˜… </span>
            <span onclick="gfg(2)" class="star">â˜… </span>
            <span onclick="gfg(3)" class="star">â˜… </span>
            <span onclick="gfg(4)" class="star">â˜… </span>
            <span onclick="gfg(5)" class="star">â˜… </span>
          </div>
          <textarea name="" id="myTextarea" cols="40" rows="4"></textarea><br>
          <button type="button" id="review-btn">submit</button>
        </div>
  </div>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
      const mainimage = document.querySelector(".img");
      const subimg = document.querySelectorAll(".subimg");

      subimg.forEach((item) => {
        item.addEventListener("click", () => {
          mainimage.src = item.src;
        });
      });

      // add items to wishlist
      const button = document.querySelector(".wishlist");
      function passIdtoAxios(id) {
        if (button.style.color == "red") {
          alert("the product is alredy in wishlist");
        } else {
          axios
            .post(`/user/passIdtoAxios/${id}`)
            .then((res) => {
              button.style.color = "red";
            })
            .catch((err) => {
              console.log(err);
            });
        }
      }

      // add to cart
      function addToCart(id) {
        axios
          .post(`/user/addToCart/${id}`)
          .then((res) => {
            const message = res.data.message;
            if (message == "the product is already in cart") {
              alert(message);
            }
          })
          .catch((err) => {
            console.log(err);
          });
      }

      let stars = document.getElementsByClassName("star");
      let output = document.getElementById("output");

      // Funtion to update rating
      function gfg(n) {
        remove();
        for (let i = 0; i < n; i++) {
          if (n == 1) cls = "one";
          else if (n == 2) cls = "two";
          else if (n == 3) cls = "three";
          else if (n == 4) cls = "four";
          else if (n == 5) cls = "five";
          stars[i].className = "star " + cls;
        }

        
        const reviewbtn= document.getElementById('review-btn')
        const hidden= document.getElementById('hidden').value
        reviewbtn.addEventListener('click',()=>{
          let textarea = document.getElementById("myTextarea");
        let textContent = textarea.value;

          axios.post(`/user/review?starcount=${n}&content=${textContent}&proId=${hidden}`)
          .then((res)=>{
            if(res.data.message=='pls login'){
              Swal.fire({
              position: "center",
              icon: "info",
              title: "please login",
              showConfirmButton: false,
              timer: 2000
              });
            }else if(res.data.message=='pls purchase this product for post review'){
              Swal.fire({
              position: "center",
              icon: "info",
              title: "please purchase this product for add review",
              showConfirmButton: false,
              timer: 2000
              });
            }else if(res.data.message=='you already reviewd this product'){
              Swal.fire({
              position: "center",
              icon: "info",
              title: "You already reviewd this product",
              showConfirmButton: false,
              timer: 2000
              });
            }else if(res.data.message=='created successfull'){
              Swal.fire({
              position: "center",
              icon: "success",
              title: "Your review added succesfully",
              showConfirmButton: false,
              timer: 2000
              });
            }else if(res.data.message=='you can review this product after deliverd'){
              Swal.fire({
              position: "info",
              icon: "success",
              title: "You can review this product after deliverd",
              showConfirmButton: false,
              timer: 2000
              });
            }
            
            console.log(res);
          })
          .catch((err)=>console.log(err))
        })
      }

      // To remove the pre-applied styling
      function remove() {
        let i = 0;
        while (i < 5) {
          stars[i].className = "star";
          i++;
        }
      }
    </script>
  </body>
</html>
