<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>shopX|history</title>
    <style>
      * {
        margin: 0;
        padding: 0;
      }
      body {
        background-color: #eee;
      }

      /* product */

      .products {
        height: auto;
        width: 30%;
        position: relative;
        top: 100px;
        left: 10%;
        display: flex;
        flex-direction: column;
        gap: 5px;
      }
      .products .card {
        height: 100px;
        width: 100%;
        display: flex;
        align-items: center;
        background-color: white;
        border: 5px solid #ffd166;
        gap: 5px;
        font-size: 13px;
      }
      .products .card .img {
        height: 100%;
        width: 20%;
        background-color: green;
      }
      .products .card .img img {
        height: 100%;
        width: 100%;
      }
      .products .card .detailes {
        height: 100%;
        width: 60%;
        padding-left: 20px;
      }
      .products .card .detailes .name {
        height: 30%;
        width: 80%;
        display: flex;
        align-items: center;
      }
      .products .card .detailes .price {
        height: 30%;
        width: 80%;
        display: flex;
        align-items: center;
      }
      .products .card .detailes .quantity {
        height: 30%;
        width: 80%;
        display: flex;
        align-items: center;
      }

      /* address */
      .address {
        height: 200px;
        width: 30%;
        border-radius: 5px;
        position: relative;
        top: 80px;
        left: 10%;
        background-color: white;
      }
      .address h4 {
        margin-top: 20px;
        margin-left: 20px;
        font-family: cursive;
      }
      .address .flex {
        margin-left: 35%;
        margin-top: 5%;
        font-family: Cambria, Cochin, Georgia, Times, "Times New Roman", serif;
      }
      /* status */

      .status {
        height: 80px;
        width: 20%;
        display: flex;
        flex-direction: column;
        position: relative;
        top: 100px;
        left: 15%;
      }
      .status .part1 {
        height: 40px;
        display: flex;
      }
      .status .part2 {
        display: flex;
        gap: 26%;
        height: 40px;
      }
      .status .part2 p {
        position: relative;
        top: 0px;
        left: 0;
        font-size: 10px;
        margin-left: 10px;
      }
      .status .one .circle {
        margin-left: 10px;
        height: 20px;
        width: 20px;
        border-radius: 20px;
        border: 1px solid gray;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: large;
      }
      .status .one .stick {
        height: 2px;
        width: 100px;
        border-radius: 0%;
        border: 1px solid gray;
      }
      .status .one {
        display: flex;
        align-items: center;
      }
      .status .two .circle {
        height: 20px;
        width: 20px;
        border-radius: 20px;
        border: 1px solid gray;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: large;
      }
      .status .two .stick {
        height: 2px;
        width: 100px;
        border-radius: 0%;
        border: 1px solid gray;
      }
      .status .two {
        display: flex;
        align-items: center;
      }
      .status .three .circle {
        height: 20px;
        width: 20px;
        border-radius: 20px;
        border: 1px solid gray;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: large;
      }
      .status .three {
        display: flex;
        align-items: center;
      }

      /* id */
      .id {
        height: 50px;
        width: 30%;
        background-color: white;
        position: relative;
        top: 50px;
        left: 10%;
        border-radius: 5px;
        color: gray;
      }
      .id p {
        font-family: "Gill Sans", "Gill Sans MT", Calibri, "Trebuchet MS",
          sans-serif;
        position: relative;
        top: 30%;
        left: 5%;
      }
      /* date */
      .date {
        height: 50px;
        width: 30%;
        background-color: white;
        color: gray;
        position: relative;
        top: 70px;
        left: 10%;
        border-radius: 5px;
      }
      .date p {
        font-family: "Gill Sans", "Gill Sans MT", Calibri, "Trebuchet MS",
          sans-serif;
        position: relative;
        top: 30%;
        left: 5%;
      }
      .payment {
        height: 80px;
        width: 30%;
        background-color: white;
        position: absolute;
        top: 130px;
        left: 50%;
        border-radius: 5px;
      }
      .payment h2 {
        text-align: center;
        font-family: "Trebuchet MS", "Lucida Sans Unicode", "Lucida Grande",
          "Lucida Sans", Arial, sans-serif;
      }
      .payment p {
        text-align: center;
        margin-top: 15px;
        font-weight: bold;
        font-family: sans-serif;
        color: #f77f00;
      }

      .pricedetailes {
        height: 200px;
        width: 30%;
        border-radius: 5px;
        position: absolute;
        top: 220px;
        left: 50%;
        background-color: white;
      }
      .pricedetailes .text {
        display: flex;
        flex-direction: column;
        gap: 20px;
      }
      .pricedetailes .text div {
        height: 20%;
        width: 30%;
        position: relative;
        top: 30px;
        left: 10%;
        font-family: sans-serif;
      }
      .pricedetailes .money {
        display: flex;
        flex-direction: column;
        gap: 20px;
      }
      .pricedetailes .money div {
        height: 20%;
        width: 30%;
        position: relative;
        top: -105px;
        left: 60%;
        font-family: sans-serif;
      }
      .container button {
        height: 30px;
        width: 10%;
        position: absolute;
        top: 450px;
        left: 70%;
        background-color: #f77f00;
        border: none;
        border-radius: 5px;
      }
    </style>
    <%- include('layout/header') -%>
  </head>
  <body>
    <%- include('layout/navbar') -%>
    <div class="container">
      <div class="id">
        <p>Order id : <%= obj._id %></p>
      </div>
      <div class="date">
        <p>Purchased on : <%= newdate %></p>
      </div>
      <div class="status">
        <div class="part1">
          <div class="one">
            <div id="circle1" class="circle"></div>
            <div id="stick1" class="stick"></div>
          </div>
          <div class="two">
            <div id="circle2" class="circle"></div>
            <div id="stick2" class="stick"></div>
          </div>
          <div class="three">
            <div id="circle3" class="circle"></div>
          </div>
        </div>
        <div class="part2">
          <p id="p1">Placed</p>
          <p id="p2">Shipped</p>
          <p id="p3">Deliverd</p>
        </div>
      </div>
      <div class="address">
        <h4>Shipping address :</h4>
        <div class="flex">
          <p><%= obj.house %></p>
          <p><%= obj.pincode %></p>
          <p><%= obj.district %></p>
          <p><%= obj.state %></p>
          <p><%= obj.mobno %></p>
        </div>
      </div>
      <div class="products">
        <% product.forEach((data)=>{ %>
        <div class="card">
          <div class="img"><img src="/<%= data.image %>" alt="" /></div>
          <div class="detailes">
            <div class="name"><%= data.name %></div>
            <div class="price">â‚¹ <%= data.balence.offerprice %></div>
            <div class="quantity"><%= data.balence.count %></div>
          </div>
        </div>
        <% }) %>
      </div>
      <div class="payment">
        <h2>Peyment type</h2>
        <p><%= obj.peymentMethord %></p>
      </div>
      <div class="pricedetailes">
        <div class="text">
          <div>Sub total</div>
          <div>Shipping charge</div>
          <div>Discount</div>
          <div>Total</div>
        </div>
        <div class="money">
          <div><%= obj.subtotal %></div>
          <div><%= obj.shippingCharge %></div>
          <div><%= obj.discount %></div>
          <div><%= obj.totalAmount %></div>
        </div>
      </div>
      <% if(obj.orderSatatus==="cancelld"){ %>
      <button style="background-color: #dad7cd">Cancelled</button>
      <%}else{ %>
      <button id="cancellbtn" onclick="cancell('<%= obj.id %>')">
        Cancell this order
      </button>
      <% } %>
      <input type="hidden" id="statusInput" value="<%= obj.orderSatatus %>" />
    </div>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
      function cancell(id) {
        if (confirm("Are you sure to cancell this product")) {
          axios
            .put("/user/cancellOrder/" + id)
            .then((res) => {
              circle1.style.color = "red";
              circle1.style.border = "none";
              circle1.innerHTML = '<i class="fa-solid fa-circle-check"></i>';

              stick1.style.backgroundColor = "red";
              stick2.style.display = "none";

              circle3.innerHTML = '<i class="fa-solid fa-circle-check"></i>';
              circle3.style.border = "none";
              circle3.style.color = "red";
              circle2.style.display = "none";
              shipped.style.display = "none";
              deliverd.textContent = "cancelled";

              btn.style.backgroundColor = "#dad7cd";
              btn.innerText = "Cancelled";
              btn.removeAttribute("onclick");
            })
            .catch((err) => {
              console.log(err);
            });
        }
      }

      // status
      const btn = document.getElementById("cancellbtn");
      const statusInput = document.querySelector("#statusInput");
      const circle1 = document.querySelector("#circle1");
      const stick1 = document.querySelector("#stick1");
      const circle2 = document.querySelector("#circle2");
      const stick2 = document.querySelector("#stick2");
      const circle3 = document.querySelector("#circle3");
      const placed = document.querySelector("#p1");
      const shipped = document.querySelector("#p2");
      const deliverd = document.querySelector("#p3");

      if (statusInput.value === "cancelled") {
        circle1.style.color = "red";
        circle1.style.border = "none";
        circle1.innerHTML = '<i class="fa-solid fa-circle-check"></i>';

        stick1.style.backgroundColor = "red";
        stick2.style.display = "none";

        circle3.innerHTML = '<i class="fa-solid fa-circle-check"></i>';
        circle3.style.border = "none";
        circle3.style.color = "red";
        circle2.style.display = "none";

        deliverd.textContent = "cancelled";
        shipped.style.display = "none";

        btn.style.backgroundColor = "#dad7cd";
              btn.innerText = "Cancelled";
              btn.removeAttribute("onclick");
      } else if (statusInput.value === "placed") {
        circle1.style.border = "none";
        circle1.innerHTML = '<i class="fa-solid fa-circle-check"></i>';
        circle1.style.color = "#70e000";
      } else if (statusInput.value === "shipped") {
        circle1.style.border = "none";
        circle1.innerHTML = '<i class="fa-solid fa-circle-check"></i>';
        circle1.style.color = "#70e000";
        circle1.style.border = "none";

        circle2.innerHTML = '<i class="fa-solid fa-circle-check"></i>';
        circle2.style.color = "#70e000";
        circle2.style.border = "none";
        stick1.style.backgroundColor = "#70e000";
      } else if (statusInput.value === "deliverd") {
        circle1.style.border = "none";
        circle1.innerHTML = '<i class="fa-solid fa-circle-check"></i>';
        circle1.style.color = "#70e000";
        circle1.style.border = "none";
        stick1.style.backgroundColor = "#70e000";

        circle2.innerHTML = '<i class="fa-solid fa-circle-check"></i>';
        circle2.style.color = "#70e000";
        circle2.style.border = "none";
        stick2.style.backgroundColor = "#70e000";

        circle3.innerHTML = '<i class="fa-solid fa-circle-check"></i>';
        circle3.style.color = "#70e000";
        circle3.style.border = "none";
      }
    </script>
  </body>
</html>
